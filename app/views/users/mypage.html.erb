<div class="container mt-4">
  <div class="row">

    <!-- 左カラム：プロフィール＋子ども一覧 -->
    <div class="col-md-4 mb-4">

      <!-- プロフィールカード -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">

          <div class="text-center mb-3">
            <% if @user.profile_image.attached? %>
              <div class="profile-icon">
                <%= image_tag @user.get_profile_image(100, 100), class: "rounded-circle" %>
              </div>
            <% else %>
              <div class="soine-avatar mx-auto">
                <%= (@user.name.presence || "U").first.upcase %>
              </div>
            <% end %>
          </div>


          <h4 class="d-flex align-items-center justify-content-between">
            <span><%= @user.name.presence || "ユーザー" %></span>
            <!-- 設定アイコン（編集ページへのリンク予定） -->
            <%= link_to edit_user_path(@user), class: "text-muted" do %>
               <i class="fa-solid fa-gear"></i>
            <% end %>

          </h4>


          <p class="text-muted mb-1">
            <i class="fas fa-map-marker-alt"></i>
            <%= @user.area&.name || "地域未設定" %>
          </p>

          <p class="mb-0">
            <%= simple_format(@user.introduction.presence || "紹介文はまだ登録されていません。") %>
          </p>
        </div>
      </div>

      <!-- 子ども一覧カード -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">子ども一覧</h5>

          <% if @user.children.any? %>
            <% @user.children.each do |child| %>
              <div class="d-flex align-items-center mb-3">
                <div class="child-avatar me-2">
                  <%= child.name.first.upcase %>
                </div>
                <div>
                  <div><strong><%= child.name %></strong></div>
                  <small class="text-muted">
                    <%= child.respond_to?(:age_label) ? child.age_label : "" %>
                  </small>
                </div>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted mb-0">まだ子ども情報が登録されていません。</p>
          <% end %>
        </div>
      </div>

    </div> <!-- /左カラム -->

    <!-- 右カラム：投稿一覧（タイムライン） -->
    <div class="col-md-8">

      <!-- タブ切り替え -->
      <div class="d-flex mb-3">
        <%= link_to "自分の投稿",
                    mypage_path,
                    class: "btn btn-sm me-2 #{params[:filter].blank? ? 'btn-primary' : 'btn-outline-primary'}" %>

        <%= link_to "タイムライン",
                    mypage_path(filter: 'timeline'),
                    class: "btn btn-sm #{params[:filter] == 'timeline' ? 'btn-primary' : 'btn-outline-primary'}" %>
      </div>

      <% if @posts.present? %>
        <% @posts.each do |post| %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between small text-muted mb-1">
                <span><%= post.user.name %></span>
                <span><%= post.created_at.strftime("%Y/%m/%d %H:%M") %></span>
              </div>
              <p class="mb-0"><%= simple_format(post.body) %></p>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="text-muted">まだ表示できる投稿がありません。</p>
      <% end %>
          
    </div> <!-- /右カラム -->

  </div> <!-- /row -->
</div>
