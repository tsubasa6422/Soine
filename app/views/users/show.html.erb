<div class="container mt-4">
  <div class="row">

    <!-- 左：プロフィール -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">

          <div class="text-center mb-3">
            <% if @user.profile_image.attached? %>
              <%= image_tag @user.get_profile_image(100, 100), class: "rounded-circle" %>
            <% else %>
              <div class="soine-avatar mx-auto">
                <%= (@user.name.presence || "U").first.upcase %>
              </div>
            <% end %>
          </div>

          <h4 class="mb-1"><%= @user.name.presence || "ユーザー" %></h4>

          <p class="text-muted mb-2">
            <i class="fas fa-map-marker-alt"></i>
            <%= @user.area&.name || "地域未設定" %>
          </p>

          <p class="mb-0">
            <%= simple_format(@user.introduction.presence || "紹介文はまだ登録されていません。") %>
          </p>

          <div class="mt-3 d-flex justify-content-between">
            <%= link_to "戻る", mypage_path(filter: params[:filter]), class: "btn btn-outline-secondary btn-sm" %>

            <% if @user == current_user %>
              <%= link_to "編集", edit_user_path(@user), class: "btn btn-primary btn-sm" %>
            <% end %>
          </div>

        </div>
      </div>
    </div>

    <!-- 右：投稿一覧 -->
    <div class="col-md-8">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0"><%= @user.name.presence || "ユーザー" %>の投稿</h5>
        <span class="badge bg-light text-muted"><%= @posts.count %>件</span>
      </div>

      <% if @posts.present? %>
        <% @posts.each do |post| %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">

              <div class="d-flex justify-content-between align-items-center small text-muted mb-2">
                <span><%= post.created_at.strftime("%Y/%m/%d %H:%M") %></span>

                <% if @user == current_user %>
                  <div class="d-flex gap-2">
                    <%= link_to "編集", edit_post_path(post), class: "btn btn-outline-secondary btn-sm" %>
                    <%= link_to "削除",
                                post_path(post),
                                method: :delete,
                                data: { confirm: "この投稿を削除しますか？" },
                                class: "btn btn-outline-danger btn-sm" %>
                  </div>
                <% end %>
              </div>

              <%= link_to post_path(post), class: "text-decoration-none text-dark d-block" do %>
                <% if post.title.present? %>
                  <h6 class="mb-1"><%= post.title %></h6>
                <% end %>
                <p class="mb-0"><%= simple_format(post.body) %></p>
              <% end %>

            </div>
          </div>
        <% end %>
      <% else %>
        <p class="text-muted">まだ投稿がありません。</p>
      <% end %>
    </div>

  </div>
</div>
